<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Сравнение цен</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  background:linear-gradient(180deg,#0f172a,#020617);
  color:white;
  min-height:100vh
}
h1{
  text-align:center;
  margin:24px 0 16px;
  font-weight:600;
  font-size:1.8rem
}
.wrapper{
  padding:16px;
  max-width:520px;
  margin:0 auto
}
.card{
  background:#020617;
  border-radius:16px;
  padding:14px 14px 12px 14px;
  margin-bottom:16px;
  box-shadow:0 0 0 1px rgba(255,255,255,.06),0 10px 20px rgba(0,0,0,.4);
  transition:.2s
}
.label{
  font-size:14px;
  opacity:.7;
  margin:12px 0 6px
}
input{
  width:100%;
  padding:14px 16px;
  border-radius:12px;
  border:none;
  background:#0f172a;
  color:white;
  font-size:16px;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.08)
}
input:focus{
  outline:none;
  box-shadow:inset 0 0 0 2px #22c55e
}
.result{
  margin-top:12px;
  font-size:17px;
  font-weight:600;
  min-height:1.4em
}
.best{
  box-shadow:0 0 0 2px #22c55e,0 0 30px rgba(34,197,94,.25);
  background:rgba(34,197,94,.06)
}
button{
  width:100%;
  padding:18px;
  border-radius:16px;
  border:none;
  font-size:18px;
  font-weight:700;
  margin-top:12px;
  cursor:pointer
}
#compareBtn{
  background:linear-gradient(90deg,#22c55e,#16a34a);
  color:#022c22
}
#shareBtn{
  background:#1e40af;
  color:white
}

/* кнопки в один ряд */
.buttons{
  display:flex;
  gap:12px;
}
.buttons button{
  flex:1;
}
</style>
</head>

<body>

<h1>Сравнение цен</h1>

<div class="wrapper">

<div class="card" id="p1">
  <input placeholder="Продукт 1">
  <div class="label">Количество</div>
  <input type="number" step="0.01" min="0">
  <div class="label">Цена</div>
  <input type="number" step="0.01" min="0">
  <div class="result"></div>
</div>

<div class="card" id="p2">
  <input placeholder="Продукт 2">
  <div class="label">Количество</div>
  <input type="number" step="0.01" min="0">
  <div class="label">Цена</div>
  <input type="number" step="0.01" min="0">
  <div class="result"></div>
</div>

<div class="buttons">
  <button id="compareBtn" onclick="compare()">Сравнить</button>
  <button id="shareBtn" onclick="share()">Поделиться</button>
</div>

</div>

<script>
function calc(card){
  const inputs = card.querySelectorAll("input");
  const qty   = parseFloat(inputs[1].value);
  const price = parseFloat(inputs[2].value);
  const res   = card.querySelector(".result");

  res.innerText = "";
  card.classList.remove("best");

  if (!qty || !price || qty <= 0 || price <= 0) return null;

  const unit = price / qty;
  const txt  = unit.toFixed(4).replace(/\.?0+$/, "");
  res.innerText = "Цена за 1 = " + txt;
  return { unit, qty, price };
}

function compare(){
  const p1 = document.getElementById("p1");
  const p2 = document.getElementById("p2");

  p1.classList.remove("best");
  p2.classList.remove("best");

  const r1 = calc(p1);
  const r2 = calc(p2);

  if (r1 === null || r2 === null) return;

  const u1 = r1.unit;
  const u2 = r2.unit;

  if (u1 < u2) {
    const diff    = ((u2 - u1) / u2 * 100).toFixed(1);
    const savings = (u2 - u1) * r1.qty;
    const s = savings.toFixed(2).replace(/\.?0+$/, "");
    p1.classList.add("best");
    p1.querySelector(".result").innerText += ` ← выгоднее на ${diff}%\nТы экономишь ${s}`;
  }
  else if (u2 < u1) {
    const diff    = ((u1 - u2) / u1 * 100).toFixed(1);
    const savings = (u1 - u2) * r2.qty;
    const s = savings.toFixed(2).replace(/\.?0+$/, "");
    p2.classList.add("best");
    p2.querySelector(".result").innerText += ` ← выгоднее на ${diff}%\nТы экономишь ${s}`;
  }
  else {
    p1.querySelector(".result").innerText += " — одинаково";
    p2.querySelector(".result").innerText += " — одинаково";
  }
}

function share(){
  const p1 = document.getElementById("p1");
  const p2 = document.getElementById("p2");
  const i1 = p1.querySelectorAll("input");
  const i2 = p2.querySelectorAll("input");

  const text = 
`${i1[0].value || "Продукт 1"}
Количество: ${i1[1].value}
Цена: ${i1[2].value}
${p1.querySelector(".result").innerText}

${i2[0].value || "Продукт 2"}
Количество: ${i2[1].value}
Цена: ${i2[2].value}
${p2.querySelector(".result").innerText}

Сравнено в PriceCompare`;

  if (navigator.share) {
    navigator.share({title:"Сравнение цен", text});
  } else {
    alert(text);
  }
}

/* PWA */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>